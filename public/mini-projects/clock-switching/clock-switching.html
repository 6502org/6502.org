<!doctype html public "-//IETF//DTD HTML//EN//2.0">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="Generator" content="Microsoft Publisher 97">
<title>6502.org: How to: Clock Speed Switching</title>
</head>
<body link="#0000ff" vlink="#ff0000" text="#000000" >
<a name=Page1></a>

  <table border=0 cellpadding=0 cellspacing=0>
    <tr>
      <td width=4 height=9></td>
      <td width=5></td>

      <td width=701></td>
      <td width=6></td>
      <td width=4></td>
    </tr>
    <tr>
      <td height=210></td>
      <td></td>
      <td width=701 height=210 colspan=1 rowspan=1 valign=top align=left>

        <table border=0 cellpadding=0 cellspacing=0>

          <tr>
            <td width=4 height=4></td>
            <td width=693></td>
            <td width=4></td>
          </tr>
          <tr>
            <td height=202></td>
            <td width=693 height=202 valign=top align=left>

<p align=center><center><B><font face="Arial" size=5>Switching between 2 clock sources for the 6502<br>
</center></p><p align=justify></B></font><font face="Arial" size=3><br>
</font><font face="Arial" size=2>It is sometimes desireable to switch between 2 different clock sources for the 6502 microprocessor. For example, with a fast, modern processor, it may be desireable to boot up at a slow clock speed to allow the boot program to be read from a slow EPROM. Once the necessary data has been copied from the EPROM into a faster RAM chip, the EPROM can be switched out of circuit and the clock speed can be increased.<br>
<br>
Switching the clock between two clock sources is not a trivial matter. To prevent the microprocessor crashing or doing weird things, there must be a clean switch from one clock to the other with no glitches or short runt pulses.<br>
<br>
The circuit shown below allows switching between two clock sources with no glitches, even when the two clocks are generated by seperate, non-synchronised oscilators.</p></font>
            </td>
            <td></td>
          </tr>

          <tr>
            <td height=4></td>
            <td colspan=2></td>
          </tr>
        </table>



      </td>
      <td colspan=2></td>

    </tr>
    <tr>
      <td height=7></td>
      <td colspan=4></td>
    </tr>
    <tr>
      <td height=452></td>
      <td width=712 height=452 colspan=3 rowspan=1 valign=top align=left>
        <img width=712 height=452 border=0 src="img0.gif">

      </td>
      <td></td>
    </tr>
    <tr>
      <td height=6></td>
      <td colspan=4></td>
    </tr>
    <tr>
      <td height=506></td>

      <td></td>
      <td width=701 height=506 colspan=1 rowspan=1 valign=top align=left>

        <table border=0 cellpadding=0 cellspacing=0>
          <tr>
            <td width=4 height=4></td>
            <td width=693></td>
            <td width=4></td>
          </tr>
          <tr>

            <td height=499></td>
            <td width=693 height=499 valign=top align=left>

<p align=left><font face="Arial" size=2>Clock A and Clock B are the two seperate clock inputs<br>
D0 is the processor D) data line<br>
Reset is the processor reset signal<br>
Write Port is created by gating together the address select signal, R/W and phase2. It should pulse low while phase 2 is high and the CPU is writing to the clock speed select circuit.<br>
<br>
<B>How the circuit works</B><br>
<br>

When the CPU changes the clock speed, the Write Port line goes low. At the end of the write cycle, the currently selected clock goes low, which loads the low Write Port signal into the two right-hand flip-flops. The lower flip-flop then holds the clock output to the CPU low via the lower of the 2 and gates.<br>
<br>
After a delay of a few nanoseconds, determined by the propagation delay in the logic that creates the Write Port line, the Write Port line will go high, loading the left-hand flip-flop with the clock select signal. This then selects the desired clock signal via the 74HC157 multiplexer.<br>
<br>
The clock pulses clock a high state into first the upper and then the lower of the two right-hand flip-flops. Until the second flip-flop goes high, the CPU clock line is held low. This generates a delay of between one and two cycles of the new clock, during which the CPU clock is held low.<br>
<br>
Since the output of the flip-flop which gates the CPU clock changes when the clock line is already low, there are no switching glitches fed through to the CPU clock.<br>
<br>
<B>Expanding to more than than 2 clock speeds</B><br>
<br>
If desired, the left-hand flip-flop could be replaced with a latch such as the 74HC175, 74HC174 or 74HC273, latching 4, 6 or 8 bits of data from the processor. The 74HC157 could then be replaced with a larger multiplexor to select between more clock inputs. The latch IC used should be a type with a reset input, so the system boot-up speed can be set to the apropriate clock source.<br>

<br>
Note : A 2-cycle CPU delay will be generated whenever the port is writen to, whether the clock speed is changed or not. For this reason, it is inadvisable to use any spare bits of the speed-select port to control something else.</p></font>
            </td>
            <td></td>
          </tr>
          <tr>
            <td height=4></td>
            <td colspan=2></td>
          </tr>

        </table>



      </td>
      <td colspan=2></td>
    </tr>
    <tr>
      <td height=10></td>
      <td colspan=4></td>

    </tr>
  </table>

</body>
</html>

